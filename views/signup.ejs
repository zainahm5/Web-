<!-- this is the body of Sign Up -->
<div class="sign-container">
    <div class="sign-background"></div>
    <div class="sign-card">
        <h2 class="sign-heading">Create an Account</h2>
        <p class="sign-subheading">Create an account to continue</p>
        <form class="form" id="signupForm" action="/signup" method="POST">

            <% if (error) { %>
                <div class="error-box"><%= error %></div>
            <% } %>            
            
            <!-- Step 1 -->
            <div id="step1" class="form-step">
                <div class="form-group">
                    <label for="email">Email address:</label>
                    <input type="email" id="email" name="email" required placeholder="example@gmail.com">
                </div>
                <div class="form-group">
                    <label for="firstName">First Name:</label>
                    <input type="text" id="firstName" name="firstName" required placeholder="First Name">
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name:</label>
                    <input type="text" id="lastName" name="lastName" required placeholder="Last Name">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" name="password" required>
                        <span class="toggle-password" onclick="togglePassword('password')">üëÅ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm password:</label>
                    <div class="password-wrapper">
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                        <span class="toggle-password" onclick="togglePassword('confirmPassword')">üëÅ</span>
                    </div>
                </div>
                <button type="button" class="sign-btn" onclick="nextStep(2)">Next Step</button>
                <p class="login-signup-text">
                    Already have an account? <a href="/signin" class="login-signup-link">Login</a>
                </p>
            </div>

            <!-- Step 2 -->
            <div id="step2" class="form-step" style="display:none;">
                <!-- Hidden fields to store Step 1 values -->
                <input type="hidden" id="hiddenEmail" name="email">
                <input type="hidden" id="hiddenFirstName" name="firstName">
                <input type="hidden" id="hiddenLastName" name="lastName">
                <input type="hidden" id="hiddenPassword" name="password">

                <div class="form-group">
                    <label for="phone">Phone number:</label>
                    <input type="text" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="nationalID">National ID / Residence number:</label>
                    <input type="text" id="nationalID" name="nationalID" required>
                </div>
                <div class="form-group">
                    <label for="birthDate">Birth date:</label>
                    <input type="date" id="birthDate" name="birthDate" required>
                </div>
                <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" name="gender" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="education">Educational Qualification:</label>
                    <select id="education" name="education" required>
                        <option value="select">Select</option>
                        <option value="highSchool">High School</option>
                        <option value="bachelorsDegree">Bachelor's Degree</option>
                        <option value="mastersDegree">Master's Degree</option>
                        <option value="phd">PhD</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="volunteeringExp">Do you have previous volunteering experience?</label>
                    <select id="volunteeringExp" name="volunteeringExp" required>
                        <option value="yes">Yes, I have</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <button type="submit" class="sign-btn" onclick="return validateStep2()">Create an Account</button>
            </div>
        </form>
    </div>
</div>

<script>
    function togglePassword(id) {
        const input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }

    async function nextStep(step) {
        if (step === 2) {
            const email = document.getElementById("email").value;
            const firstName = document.getElementById("firstName").value;
            const lastName = document.getElementById("lastName").value;
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;

            document.querySelectorAll(".error-box").forEach(el => el.remove());

            if (!email || !firstName || !lastName || !password || !confirmPassword) {
                showError("Please fill out all fields.");
                return;
            }

            if (password !== confirmPassword) {
                showError("Passwords do not match!");
                return;
            }

            try {
                const response = await fetch(`/check-email?email=${email}`);
                const data = await response.json();

                if (data.exists) {
                    showError("The email you entered is already registered.");
                    return;
                }
            } catch (error) {
                showError("An error occurred. Please try again.");
                return;
            }

            document.getElementById("hiddenEmail").value = email;
            document.getElementById("hiddenFirstName").value = firstName;
            document.getElementById("hiddenLastName").value = lastName;
            document.getElementById("hiddenPassword").value = password;

            document.getElementById("step1").style.display = "none";
            document.getElementById("step2").style.display = "block";
        }
    }

    function validateStep2() {
        const phone = document.getElementById("phone").value;
        const nationalID = document.getElementById("nationalID").value;
        const birthDate = document.getElementById("birthDate").value;
        const gender = document.getElementById("gender").value;
        const education = document.getElementById("education").value;
        const volunteeringExp = document.getElementById("volunteeringExp").value;

        if (!phone || !nationalID || !birthDate || !gender || education === "select" || !volunteeringExp) {
            showError("Please fill out all fields before submitting.");
            return false;
        }
        return true;
    }

    function showError(message) {
        let errorBox = document.querySelector(".error-box");
        if (!errorBox) {
            errorBox = document.createElement("div");
            errorBox.className = "error-box";
            document.getElementById("signupForm").insertBefore(errorBox, document.getElementById("signupForm").firstChild);
        }
        errorBox.innerText = message;
    }
</script>

